version: '3.8'

services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: pdf_to_text_qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_storage:/qdrant/storage
    restart: unless-stopped

  pdf-to-text:
    build: .
    container_name: pdf_to_text_service
    ports:
      - "8003:8003"  # gRPC port
    environment:
      - SERVICE_NAME=pdf-to-text-service
      - API_HOST=0.0.0.0
      - API_PORT=8003
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - QDRANT_COLLECTION_NAME=documents
      - EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
      - EMBEDDING_DIMENSION=384
      - CHUNK_SIZE=512
      - CHUNK_OVERLAP=50
      - MAX_FILE_SIZE_MB=100
      - LOG_LEVEL=INFO
    depends_on:
      - qdrant
    restart: unless-stopped
    volumes:
      - ./logs:/app/logs

volumes:
  qdrant_storage:
    driver: local

