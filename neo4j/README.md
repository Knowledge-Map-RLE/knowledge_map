# Neo4j Test Data Scripts

Эта папка содержит скрипты для заполнения Neo4j тестовыми данными и их проверки.

## Файлы

- `populate_test_data.py` - Основной скрипт для заполнения данными (с интерактивным подтверждением)
- `run_populate.py` - Упрощенный скрипт для автоматического заполнения
- `test_data_verification.py` - Тесты для проверки корректности данных
- `README.md` - Этот файл

## Использование

### 1. Подготовка

Убедитесь что Neo4j запущен и доступен:
```bash
# Через Docker
docker run -p 7474:7474 -p 7687:7687 -e NEO4J_AUTH=neo4j/password neo4j:5.0

# Или через docker-compose из корневой папки проекта
cd ..
docker-compose up neo4j
```

### 2. Установка зависимостей

```bash
cd ../api
poetry install
```

### 3. Заполнение данными

**Интерактивный режим (с подтверждением):**
```bash
cd neo4j
python populate_test_data.py
```

**Автоматический режим:**
```bash
cd neo4j
python run_populate.py
```

### 4. Проверка данных

```bash
cd neo4j
python test_data_verification.py
```

## Переменные окружения

Можно настроить подключение к Neo4j через переменные окружения:

```bash
export NEO4J_URL="bolt://localhost:7687"
export NEO4J_USER="neo4j"
export NEO4J_PASSWORD="password"
```

## Создаваемые данные

Скрипт создает:
- **1 пользователь** - тестовый пользователь для создания блоков
- **100 блоков** - распределенных по 10 слоям и 5 уровням
- **~100 связей** - ациклические связи между блоками
- **~25 тегов** - технические теги (python, javascript, react, etc.)
- **Связи тегов с блоками** - каждому блоку назначается 1-3 случайных тега

## Проверяемые аспекты

Тесты проверяют:
- ✅ Подключение к базе данных
- ✅ Существование всех типов объектов
- ✅ Корректность полей и связей
- ✅ Ацикличность графа
- ✅ Консистентность данных
- ✅ Производительность запросов
- ✅ Статистику распределения данных

## Примеры использования

### Быстрое заполнение и проверка:
```bash
cd neo4j
python run_populate.py && python test_data_verification.py
```

### Для разработки:
```bash
# Очистить и заполнить заново
python run_populate.py

# Проверить что всё корректно
python test_data_verification.py
```

## Решение проблем

**Ошибка подключения к Neo4j:**
- Убедитесь что Neo4j запущен
- Проверьте правильность URL и учетных данных
- Для Docker: `docker ps` должен показывать запущенный контейнер

**Ошибки импорта модулей:**
- Убедитесь что находитесь в папке `neo4j/`
- Проверьте что в папке `api/` установлены зависимости через Poetry

**Тесты падают:**
- Сначала запустите заполнение данными
- Убедитесь что данные создались корректно
- Проверьте версию Neo4j (рекомендуется 5.0+) 